pipeline{
    agent any 
    environment{
        APP_NAME =  'flex'
        USER_NAME = "(withCredentials([string(credentialsId: 'username', variable: '')]) {})"
    }'
        DOCKER_PASS = "withCredentials([string(credentialsId: 'password', variable: '')]) {
}"
    
    stages{
        stage('Cleanup workspace'){
            steps{
                script{
                    cleanWs()

                }
            }
        }
                stage('Checkout SCM') {
                    steps{
                        script{
                            checkout scmGit(branches: [[name: '*/main']],\
                            extensions: [], \
                            userRemoteConfigs: [[url: 'https://github.com/mshow1980/Scion-Scope']])

                        }
                    }
                }
                stage('Docker Build') {
                    steps{
                        script{
                            sh 'docker build -t mshow1980/mynewapp:$BUILD_NUMBER .'
                        }
                    }
                }
                stage('Docker login') {
                    steps{
                        script{
                            sh 'docker login -u USER_NAME -p DOCKER_PASS'
                        }
                    }
                }
                stage('docker push') {
                    steps{
                        script{
                            sh 'docker push  mshow1980/mynewapp:$BUILD_NUMBER'
                        }
                    }
                
                }
            }
        }

