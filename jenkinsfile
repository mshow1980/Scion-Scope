pipeline{
    agent any 
    environment{
        APP_NAME = 'argocd_project'
    }
    stages{
        stage('Cleanup workspace') {
            steps{
                script{
                    cleanWs()
                }
            }
        }
        stage('Checkout SCM') {
            steps{
                script{
                    checkout scmGit(branches: [[name: '*/main']],\
                    extensions: [], \
                    userRemoteConfigs: [[url: 'https://github.com/mshow1980/Scion-Scope']])
                    }
                }
            }
                stage('Docker Build') {
                    steps{
                        script{
                            sh 'docker build -t mshow1980/${APP_NAME}:$BUILD_NUMBER .'
                        }
                    }
                }
                stage('Docker login') {
                    steps{
                        script{
                            withCredentials([string(credentialsId: 'Password', variable: 'Password')]) {
                                sh 'docker login -u mshow1980 -p Password'
                            }
                        }
                    }
                }
                stage('docker push') {
                    steps{
                        script{
                            sh 'docker push  mshow1980/${APP_NAME}:$BUILD_NUMBER'
                        }
                    }
                
                }
            }
        }
    